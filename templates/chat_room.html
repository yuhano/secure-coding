{% extends "base.html" %}
{% block title %}ì±„íŒ… â€” {{ product_title }}{% endblock %}
{% block content %}
<h2>ğŸ’¬ {{ product_title }} ({{ other_name }})</h2>

{% if is_seller %}
<button id="send_account_btn" style="margin-bottom:8px;">
  ë‚´ ê³„ì¢Œë²ˆí˜¸ ì „ì†¡
</button>
{% endif %}

<div id="chat_window" style="height:300px; overflow-y:auto; border:1px solid #e0e0e0; padding:10px;">
  {% for m in messages %}
    <div style="margin-bottom:8px;">
      <strong>{{ m.username }}:</strong> {{ m.message }}
      <div style="font-size:0.8em; color:#888;">{{ m.timestamp }}</div>
    </div>
  {% endfor %}
</div>

<input id="chat_input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
<button id="send_btn">ì „ì†¡</button>

<script>
  var socket = io();
  var room = "{{ room_id }}";
  var myAcc = "{{ my_account }}";

  socket.on('connect', function(){
    socket.emit('join_room', { room_id: room });
  });
  socket.on('chat_message', function(data){
    var win = document.getElementById('chat_window');
    var item = document.createElement('div');
    item.innerHTML = 
      '<strong>'+ data.username +':</strong> '+
      data.message +
      '<div style="font-size:0.8em; color:#888;">'+ data.timestamp +'</div>';
    win.appendChild(item);
    win.scrollTop = win.scrollHeight;
  });

  document.getElementById('send_btn').onclick = function(){
    var msg = document.getElementById('chat_input').value;
    if(!msg) return;
    socket.emit('private_message', {
      room_id: room,
      message: msg
    });
    document.getElementById('chat_input').value = '';
  };
  // ë²„íŠ¼ì´ ìˆìœ¼ë©´(=íŒë§¤ìì´ë©´) í´ë¦­ í•¸ë“¤ëŸ¬ ë“±ë¡
  var sendAccBtn = document.getElementById('send_account_btn');
  if (sendAccBtn) {
    sendAccBtn.addEventListener('click', function(){
       if (!myAcc) {
         alert("ë¨¼ì € í”„ë¡œí•„ì—ì„œ ê³„ì¢Œë²ˆí˜¸ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.");
         return;
       }
       socket.emit('private_message', {
         room_id: room,
         message: "ì œ ê³„ì¢Œë²ˆí˜¸: " + myAcc
       });
     });
   }
</script>
{% endblock %}
